---
---
<header class="fixed top-4 left-1/2 -translate-x-1/2 z-50 w-full max-w-screen-xl pointer-events-none">
  
  <!-- Desktop -->
  <div class="hidden md:flex items-center justify-center">
    <nav id="main-nav" class="relative flex items-center gap-1 rounded-full border border-white/10 bg-black/60 backdrop-blur-md shadow-lg px-3 py-2 pointer-events-auto" aria-label="Primary">
      <!-- Wordmark -->
      <a href="/" class="flex items-center px-3 h-10 rounded-full hover:bg-white/5 transition" aria-label="Home">
        <span class="inline-flex items-baseline gap-1.5">
          <span class="text-white/95 font-semibold tracking-[0.06em] text-[14px]">D‑Essence</span>
          <span class="text-white/70 font-medium tracking-wide text-[12.5px]">Wellness</span>
        </span>
      </a>

      <!-- Categories -->
      <ul class="flex items-center gap-1 h-10">

        <!-- Injectables -->
        <li class="relative" data-nav-item>
          <button class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white" data-nav-trigger aria-haspopup="true" aria-expanded="false" aria-controls="panel-injectables">
            Injectables
            <svg class="ml-1 w-4 h-4 opacity-70" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z" clip-rule="evenodd" />
            </svg>
          </button>
          <div id="panel-injectables" role="menu" class="absolute left-0 mt-2 w-[760px] max-w-[98vw] rounded-2xl border border-white/10 bg-black/70 backdrop-blur-md p-4 hidden" data-nav-panel>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2">
              <a href="/services/injectables/botox" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Botox</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/injectables/xeomin" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Xeomin</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/injectables/daxxify" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Daxxify</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/injectables/botox-hyperhidrosis" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition sm:col-span-2">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Botox for Hyperhidrosis</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/microneedling/prp" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">PRP Microneedling</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/microneedling/prf" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">PRF Microneedling</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/fillers/juvederm" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition sm:col-span-2">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Dermal Fillers — Juvederm® Collection</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/threads/smooth-threads" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Threads — Smooth Threads</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
            </div>
          </div>
        </li>

        <!-- Laser Treatments -->
        <li class="relative" data-nav-item>
          <button class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white" data-nav-trigger aria-haspopup="true" aria-expanded="false" aria-controls="panel-laser">
            Laser Treatments
            <svg class="ml-1 w-4 h-4 opacity-70" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z" clip-rule="evenodd" />
            </svg>
          </button>
          <div id="panel-laser" role="menu" class="absolute left-0 mt-2 w-[560px] max-w-[95vw] rounded-2xl border border-white/10 bg-black/70 backdrop-blur-md p-4 hidden" data-nav-panel>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
              <a href="/services/aerolase" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Aerolase</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/laser-hair-removal" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Laser Hair Removal</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
            </div>
          </div>
        </li>

        <!-- Aesthetic Services -->
        <li class="relative" data-nav-item>
          <button class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white" data-nav-trigger aria-haspopup="true" aria-expanded="false" aria-controls="panel-aesthetic">
            Aesthetic Services
            <svg class="ml-1 w-4 h-4 opacity-70" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z" clip-rule="evenodd" />
            </svg>
          </button>
          <div id="panel-aesthetic" role="menu" class="absolute left-0 mt-2 w-[560px] max-w-[95vw] rounded-2xl border border-white/10 bg-black/70 backdrop-blur-md p-4 hidden" data-nav-panel>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
              <a href="/services/waxing-sugaring" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Waxing &amp; Sugaring</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/teeth-whitening" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Teeth Whitening</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
            </div>
          </div>
        </li>

        <!-- Wellness -->
        <li class="relative" data-nav-item>
          <button class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white" data-nav-trigger aria-haspopup="true" aria-expanded="false" aria-controls="panel-wellness">
            Wellness
            <svg class="ml-1 w-4 h-4 opacity-70" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z" clip-rule="evenodd" />
            </svg>
          </button>
          <div id="panel-wellness" role="menu" class="absolute left-0 mt-2 w-[840px] max-w-[98vw] rounded-2xl border border-white/10 bg-black/70 backdrop-blur-md p-5 hidden" data-nav-panel>
            <div class="rounded-xl border border-white/10 bg-white/5 p-3 mb-3">
              <p class="text-sm text-white/80">Vitamin Injections &amp; IV Therapy</p>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2">
              <a href="/services/vitamin-injections/b12" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">B12 (Methylcobalamin)</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/vitamin-injections/l-carnitine" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">L‑Carnitine</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/vitamin-injections/amino-blend" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Amino Blend</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/vitamin-injections/micc" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">MICC</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/vitamin-injections/lipo-plus" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Lipo Plus</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/vitamin-injections/glutathione" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Glutathione</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/vitamin-injections/tri-immune-boost" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">Tri‑Immune Boost</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
              <a href="/services/iv-infusions" class="group rounded-xl border border-white/10 bg-white/5 p-3 hover:bg-white/10 hover:border-white/20 transition">
                <div class="flex items-center justify-between"><h4 class="text-white/90 font-medium">IV Infusions</h4><svg class="w-4 h-4 opacity-70 group-hover:translate-x-0.5 transition" viewBox="0 0 20 20" fill="currentColor"><path d="M7 5l5 5-5 5"/></svg></div>
              </a>
            </div>
          </div>
        </li>

      </ul>
    </nav>
  </div>

  <!-- Mobile -->
  <div class="md:hidden pointer-events-auto px-4">
    <div class="flex items-center justify-between rounded-2xl border border-white/10 bg-neutral-900/75 text-white backdrop-blur-lg shadow-lg px-3 py-2">
      <a href="/" class="py-2" aria-label="Home">
        <span class="inline-flex items-baseline gap-1.5">
          <span class="text-white/95 font-semibold tracking-[0.06em] text-[14px]">D‑Essence</span>
          <span class="text-white/70 font-medium tracking-wide text-[12.5px]">Wellness</span>
        </span>
      </a>
      <button id="mobile-toggle" class="px-3 py-2 rounded-lg hover:bg-white/10" aria-expanded="false" aria-controls="mobile-nav">Menu</button>
    </div>
    <div id="mobile-nav" class="hidden mt-2 rounded-2xl border border-white/10 bg-neutral-900/95 text-white shadow-xl">
      <div class="p-3 text-sm">
        <div class="px-3 py-2 text-xs uppercase tracking-wide text-white/50">Injectables</div>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/botox">Botox®</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/xeomin">Xeomin®</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/daxxify">Daxxify®</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/botox-hyperhidrosis">Botox® for Hyperhidrosis</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/prp-microneedling">PRP Microneedling</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/prf-microneedling">PRF Microneedling</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/dermal-fillers">Dermal Fillers</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/juvederm-fillers">Juvederm® Collection</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/smooth-threads">Smooth Threads</a>

        <div class="px-3 pt-3 pb-2 text-xs uppercase tracking-wide text-white/50">Laser Treatments</div>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/aerolase/acne">Aerolase — Acne</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/aerolase/rosacea">Aerolase — Rosacea</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/aerolase/hyperpigmentation">Aerolase — Hyperpigmentation</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/aerolase/melasma">Aerolase — Melasma</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/aerolase/skin-rejuvenation">Aerolase — Skin Rejuvenation</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/aerolase/collagen-boosting">Aerolase — Collagen Boosting</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/aerolase/psoriasis">Aerolase — Psoriasis</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/aerolase/eczema">Aerolase — Eczema</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/aerolase/vascular-lesions">Aerolase — Vascular Lesions</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/laser-hair-removal">Laser Hair Removal</a>

        <div class="px-3 pt-3 pb-2 text-xs uppercase tracking-wide text-white/50">Advanced Skin Care</div>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/facials">Specialty Facials</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/chemical-peels/perfect-derma-peel">Perfect Derma Peel</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/chemical-peels/biorepeel">BioRePeel</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/microneedling">Microneedling</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/microneedling/skinpen">SkinPen® Microneedling</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/prp-microneedling">PRP Microneedling</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/prf-microneedling">PRF Microneedling</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/dermaplaning">Dermaplaning</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/enzyme-treatments">Enzyme Treatments</a>

        <div class="px-3 pt-3 pb-2 text-xs uppercase tracking-wide text-white/50">Wellness</div>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/vitamin-injections/b12">B12</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/vitamin-injections/l-carnitine">L‑Carnitine</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/vitamin-injections/amino-blend">Amino Blend</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/vitamin-injections/micc">MICC</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/vitamin-injections/lipo-plus">Lipo Plus</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/vitamin-injections/glutathione">Glutathione</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/vitamin-injections/tri-immune-boost">Tri‑Immune Boost</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/vitamin-injections/iv-infusions">IV Infusions</a>

        <div class="px-3 pt-3 pb-2 text-xs uppercase tracking-wide text-white/50">Aesthetic Services</div>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/waxing/full-face">Waxing — Full Face</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/waxing/brows">Waxing — Brows</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/waxing/bikini">Waxing — Bikini</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/waxing/body">Waxing — Body</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/teeth-whitening">Teeth Whitening</a>

        <div class="px-3 pt-3 pb-2 text-xs uppercase tracking-wide text-white/50">Events</div>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/events/botox-parties">Botox® Parties</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/events/spa-parties">Spa Parties</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/events/skincare-workshops">Skincare Workshops</a>

        <div class="px-3 pt-3 pb-2 text-xs uppercase tracking-wide text-white/50">Skincare Products</div>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/skincare/circadia">Circadia®</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/skincare/face-reality">Face Reality®</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/skincare/hydrinity">Hydrinity®</a>
        <a class="block px-3 py-2 rounded-lg hover:bg-white/5" href="/services/skincare/skinmedica">SkinMedica®</a>
      </div>
    </div>
  </div>
</header>

<script is:inline>
  const btn = document.getElementById('mobile-toggle');
  const nav = document.getElementById('mobile-nav');
  if (btn && nav) { btn.addEventListener('click', () => { const hidden = nav.classList.toggle('hidden'); btn.setAttribute('aria-expanded', (!hidden).toString()); }); }
</script>

<script is:inline>
  // Dropdown UX: Hover intent + click-to-pin (exclusive open)
  (function() {
    const nav = document.getElementById('main-nav');
    if (!nav) return;

    const items  = Array.from(nav.querySelectorAll('[data-nav-item]'));
    const panels = () => Array.from(nav.querySelectorAll('[data-nav-panel]'));
    const triggers = () => Array.from(nav.querySelectorAll('[data-nav-trigger]'));

    let openTimer = null;
    let closeTimer = null;
    let pinnedItem = null;

    const OPEN_DELAY  = 140;
    const CLOSE_DELAY = 180;
    const clearTimers = () => { if (openTimer) clearTimeout(openTimer); if (closeTimer) clearTimeout(closeTimer); openTimer = closeTimer = null; };

    function closeAll() {
      panels().forEach(p => p.classList.add('hidden'));
      triggers().forEach(b => b.setAttribute('aria-expanded', 'false'));
    }
    function openOnly(item) {
      if (pinnedItem && pinnedItem !== item) pinnedItem = null;
      closeAll();
      const panel = item.querySelector('[data-nav-panel]');
      const btn   = item.querySelector('[data-nav-trigger]');
      if (panel && btn) {
        panel.classList.remove('hidden');
        btn.setAttribute('aria-expanded', 'true');
      }
    }

    items.forEach(item => {
      const btn = item.querySelector('[data-nav-trigger]');
      const panel = item.querySelector('[data-nav-panel]');
      if (!btn || !panel) return;

      item.addEventListener('mouseenter', () => {
        if (pinnedItem && pinnedItem !== item) return;
        clearTimers();
        openTimer = setTimeout(() => openOnly(item), OPEN_DELAY);
      });
      item.addEventListener('mouseleave', () => {
        if (pinnedItem === item) return;
        clearTimers();
        closeTimer = setTimeout(() => { if (!pinnedItem) closeAll(); }, CLOSE_DELAY);
      });

      btn.addEventListener('click', (e) => {
        e.preventDefault();
        clearTimers();
        if (pinnedItem === item) { pinnedItem = null; closeAll(); }
        else { pinnedItem = item; openOnly(item); }
      });

      btn.addEventListener('focus', () => { if (!pinnedItem) openOnly(item); });
      btn.addEventListener('blur',  () => { if (!pinnedItem) { clearTimers(); closeTimer = setTimeout(closeAll, CLOSE_DELAY); } });
      panel.addEventListener('mouseenter', () => clearTimers());
      panel.addEventListener('mouseleave', () => { if (!pinnedItem) { clearTimers(); closeTimer = setTimeout(closeAll, CLOSE_DELAY); } });
      panel.addEventListener('focusin',  () => clearTimers());
      panel.addEventListener('focusout', () => { if (!pinnedItem) { clearTimers(); closeTimer = setTimeout(closeAll, CLOSE_DELAY); } });
    });

    document.addEventListener('click', (e) => {
      if (!nav.contains(e.target)) { pinnedItem = null; closeAll(); }
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') { pinnedItem = null; closeAll(); }
    });
  })();
</script>

