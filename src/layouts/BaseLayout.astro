---
export interface Props {
  seo?: {
    title?: string;
    description?: string;
    canonical?: string;
    type?: string;
    jsonLd?: any[];
  };
}
import "../styles/globals.css";
const { seo } = Astro.props;
const title = seo?.title ?? 'D-Essence Wellness';
const description = seo?.description ?? 'Modern Aesthetics, Evidence-Based Care';
const canonical = seo?.canonical ?? '/';
const type = seo?.type ?? 'website';
const jsonLd = seo?.jsonLd ?? [];
---

<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonical} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content={type} />

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" sizes="any" />

    <!-- Pro typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
    <style>
      :root { --font-sans: "Inter", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
      html, body { font-family: var(--font-sans); }
    </style>

    {jsonLd.length > 0 && (
      <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
    )}
  </head>

  <body class="min-h-full bg-[radial-gradient(1200px_700px_at_50%_-100px,#0b0b0b,transparent)]">
    <!-- Mobile nav controller -->
    <input id="nav-toggle" type="checkbox" class="peer sr-only" aria-hidden="true" />

    <!-- ===== HEADER ===== -->
    <header class="fixed top-4 left-1/2 -translate-x-1/2 z-[4000] w-full max-w-screen-xl pointer-events-none">
      <!-- Desktop -->
      <div class="hidden md:flex items-center justify-center pointer-events-auto">
        <nav class="relative flex items-center gap-1 rounded-full border border-white/10 bg-black/80 shadow-lg px-3 py-2 leading-none"
             aria-label="Primary" role="menubar">
          <!-- Logo -->
          <a href="/" class="flex items-center px-3 h-10 rounded-full hover:bg-white/5 transition focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20" aria-label="Home">
            <span class="inline-flex items-center h-full">
              <span class="text-white/95 font-semibold tracking-[0.06em] text-[14px] leading-none">D-Essence</span>
              <span class="ml-1.5 text-white/70 font-medium tracking-wide text-[12.5px] leading-none">Wellness</span>
            </span>
          </a>

          <!-- Menu -->
          <ul class="flex items-center gap-1 h-10">
            <!-- Cosmetic Injectables -->
            <li class="relative group" role="none">
              <button
                class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20"
                type="button"
                role="menuitem"
                aria-haspopup="true"
                aria-expanded="false"
                aria-controls="menu-injectables"
                data-menu-trigger="injectables"
              >
                Cosmetic Injectables
                <svg class="ml-1 w-4 h-4 opacity-70" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z" clip-rule="evenodd" />
                </svg>
              </button>

              <div id="menu-injectables"
                   class="absolute left-1/2 -translate-x-1/2 top-full mt-2 w=[90vw] sm:w-[520px]
                          rounded-2xl border border-white/10 bg-neutral-950 z-[4050] shadow-2xl p-1
                          max-h-[70vh] overflow-auto
                          opacity-0 translate-y-1 pointer-events-none
                          transition duration-150
                          group-hover:opacity-100 group-hover:translate-y-0 group-hover:pointer-events-auto
                          focus-within:opacity-100 focus-within:translate-y-0 focus-within:pointer-events-auto
                          before:content-[''] before:absolute before:-top-6 before:left-0 before:right-0 before:h-6"
                   role="menu" tabindex="-1" data-menu-panel="injectables">
                <ul class="divide-y divide-white/10">
                  <li><a href="/services/botox" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">Neurotoxins<span class="opacity-60">→</span></a></li>
                  <li><a href="/services/juvederm-fillers" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">Dermal Fillers<span class="opacity-60">→</span></a></li>
                  <li><a href="/services/prp-microneedling" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">PRP Therapy<span class="opacity-60">→</span></a></li>
                  <li><a href="/services/lip-filler" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">Lip Fillers<span class="opacity-60">→</span></a></li>
                  <li><a href="/services/botox-for-hyperhidrosis" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">Underarm Hyperhidrosis Treatment<span class="opacity-60">→</span></a></li>
                </ul>
              </div>
            </li>

            <!-- Laser (single link) -->
            <li role="none">
              <a href="/services/aerolase" class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20" role="menuitem">
                Laser
              </a>
            </li>

            

            <!-- Skin Goals -->
            <li class="relative group" role="none">
              <button
                class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20"
                type="button"
                role="menuitem"
                aria-haspopup="true"
                aria-expanded="false"
                aria-controls="menu-skin"
                data-menu-trigger="skin"
              >
                Skin Goals
                <svg class="ml-1 w-4 h-4 opacity-70" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z" clip-rule="evenodd" />
                </svg>
              </button>

              <div id="menu-skin"
                   class="absolute left-1/2 -translate-x-1/2 top-full mt-2 w-[90vw] sm:w-[520px]
                          rounded-2xl border border-white/10 bg-neutral-950 z-[4050] shadow-2xl p-1
                          max-h-[70vh] overflow-auto
                          opacity-0 translate-y-1 pointer-events-none
                          transition duration-150
                          group-hover:opacity-100 group-hover:translate-y-0 group-hover:pointer-events-auto
                          focus-within:opacity-100 focus-within:translate-y-0 focus-within:pointer-events-auto
                          before:content-[''] before:absolute before:-top-6 before:left-0 before:right-0 before:h-6"
                   role="menu" tabindex="-1" data-menu-panel="skin">
                <ul class="divide-y divide-white/10">
                  <li><a href="/services/skinpen-microneedling" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">Skin Pen Microneedle<span class="opacity-60">→</span></a></li>
                  <li><a href="/services/smooth-threads" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">Smooth Threads<span class="opacity-60">→</span></a></li>
                  <li><a href="/services/sugaring" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">Sugaring<span class="opacity-60">→</span></a></li>
                  <li><a href="/services/signature-facials" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">Signature Facials<span class="opacity-60">→</span></a></li>
                  <li><a href="/services/facial-waxing" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">Facial Waxing<span class="opacity-60">→</span></a></li>
                  <li><a href="/services/acne-programs" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">Teen Acne Facial<span class="opacity-60">→</span></a></li>
                </ul>
              </div>
            </li>
<!-- Swedish Massage (single link) -->
<li role="none">
  <a href="/services/swedish_massage" class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20" role="menuitem">
    Swedish Massage
  </a>
</li>

              </a>
            </li>
            <!-- Wellness -->
            <li class="relative group" role="none">
              <button
                class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20"
                type="button"
                role="menuitem"
                aria-haspopup="true"
                aria-expanded="false"
                aria-controls="menu-wellness"
                data-menu-trigger="wellness"
              >
                Wellness
                <svg class="ml-1 w-4 h-4 opacity-70" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z" clip-rule="evenodd" />
                </svg>
              </button>

              <div id="menu-wellness"
                   class="absolute left-1/2 -translate-x-1/2 top-full mt-2 w-[90vw] sm:w-[420px]
                          rounded-2xl border border-white/10 bg-neutral-950 z-[4050] shadow-2xl p-1
                          max-h-[70vh] overflow-auto
                          opacity-0 translate-y-1 pointer-events-none
                          transition duration-150
                          group-hover:opacity-100 group-hover:translate-y-0 group-hover:pointer-events-auto
                          focus-within:opacity-100 focus-within:translate-y-0 focus-within:pointer-events-auto
                          before:content-[''] before:absolute before:-top-6 before:left-0 before:right-0 before:h-6"
                   role="menu" tabindex="-1" data-menu-panel="wellness">
                <ul class="divide-y divide-white/10">
                  <li><a href="/services/vitamin-injections" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">Vitamin Injections<span class="opacity-60">→</span></a></li>
                  <li><a href="/services/iv-therapy" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">IV Therapy<span class="opacity-60">→</span></a></li>
                  <!-- Added Teeth Whitening -->
                  <li><a href="/services/teeth-whitening" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">Teeth Whitening<span class="opacity-60">→</span></a></li>
                </ul>
              </div>
            </li>

            

            <!-- Chemical Peel (renombrado desde Aesthetic Services) -->
            <li class="relative group" role="none">
              <button
                class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20"
                type="button"
                role="menuitem"
                aria-haspopup="true"
                aria-expanded="false"
                aria-controls="menu-aesthetics"
                data-menu-trigger="aesthetics"
              >
                Chemical Peel
                <svg class="ml-1 w-4 h-4 opacity-70" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z" clip-rule="evenodd" />
                </svg>
              </button>

              <div id="menu-aesthetics"
                   class="absolute left-1/2 -translate-x-1/2 top-full mt-2 w-[90vw] sm:w-[420px]
                          rounded-2xl border border-white/10 bg-neutral-950 z-[4050] shadow-2xl p-1
                          max-h-[70vh] overflow-auto
                          opacity-0 translate-y-1 pointer-events-none
                          transition duration-150
                          group-hover:opacity-100 group-hover:translate-y-0 group-hover:pointer-events-auto
                          focus-within:opacity-100 focus-within:translate-y-0 focus-within:pointer-events-auto
                          before:content-[''] before:absolute before:-top-6 before:left-0 before:right-0 before:h-6"
                   role="menu" tabindex="-1" data-menu-panel="aesthetics">
                <ul class="divide-y divide-white/10">
                  <li><a href="/services/biorepeel" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">BioRePeel<span class="opacity-60">→</span></a></li>
                  <li><a href="/services/the-perfect-derma-peel" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90 focus:outline-none focus:bg-white/10" role="menuitem" tabindex="-1">The Perfect Derma Peel<span class="opacity-60">→</span></a></li>
                </ul>
              </div>
            </li>

            <!-- Single links -->
            <li role="none"><a href="/about-us" class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20" role="menuitem">About Us</a></li>
            <li role="none"><a href="/contact-us" class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20" role="menuitem">Contact Us</a></li>
          </ul>
        </nav>
      </div>

      <!-- Mobile bar -->
      <div class="md:hidden px-4 pointer-events-auto">
        <div class="flex items-center justify-between rounded-2xl border border-white/10 bg-neutral-900/75 text-white backdrop-blur-lg shadow-lg px-3 py-2">
          <a href="/" class="py-2" aria-label="Home">
            <span class="inline-flex items-baseline gap-1.5">
              <span class="text-white/95 font-semibold tracking-[0.06em] text-[14px]">D-Essence</span>
              <span class="text-white/70 font-medium tracking-wide text-[12.5px]">Wellness</span>
            </span>
          </a>
          <label for="nav-toggle" class="p-2 rounded-lg hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20" aria-controls="mobile-drawer" aria-label="Open menu" role="button" tabindex="0">
            <svg class="w-6 h-6 peer-checked:hidden" viewBox="0 0 24 24" fill="none"><path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            <svg class="w-6 h-6 hidden peer-checked:block" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          </label>
        </div>
      </div>
    </header>

    <!-- Overlays for mobile -->
    <div class="fixed inset-0 z-[10000] bg-black/60 opacity-0 pointer-events-none transition-opacity duration-200 peer-checked:opacity-100 peer-checked:pointer-events-auto"></div>
    <div class="fixed inset-0 right-[8%] z-[10005] bg-black/10 backdrop-blur-[2px] opacity-0 pointer-events-none transition-opacity duration-200 peer-checked:opacity-100 peer-checked:pointer-events-auto"></div>

    <!-- ===== MOBILE DRAWER ===== -->
    <aside id="mobile-drawer"
      class="fixed right-0 top-0 z-[10010] h-dvh w-[92%] max-w-none bg-neutral-900 text-white border-l border-white/10 shadow-2xl translate-x-full transition-transform duration-200 will-change-transform peer-checked:translate-x-0"
      aria-modal="true" role="dialog">
      <!-- Header del drawer -->
      <div class="flex items-center justify-between px-3 py-3 border-b border-white/10">
        <button type="button" aria-label="Close menu"
          class="inline-flex items-center justify-center h-10 w-10 rounded-lg hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20"
          data-close-drawer>
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </button>
        <div class="text-sm text-white/60 pr-2">Menu</div>
      </div>

      <div class="h-[calc(100dvh-48px)] flex flex-col">
        <!-- Navegación -->
        <nav class="flex-1 overflow-auto py-2">
          <div class="px-2 space-y-2">
            <!-- Cosmetic Injectables (móvil) -->
            <details class="group rounded-xl border border-white/10 bg-white/5 open:bg-white/5 open:border-white/20 transition-colors">
              <summary class="list-none cursor-pointer flex items-center justify-between px-4 py-3">
                <span class="font-medium">Cosmetic Injectables</span>
                <svg class="w-5 h-5 transition-transform group-open:rotate-180" viewBox="0 0 20 20" fill="currentColor"><path d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z"/></svg>
              </summary>
              <div class="px-2 pb-2">
                <div class="mx-2 rounded-lg bg-white/5 ring-1 ring-white/10">
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/botox">Neurotoxins</a>
                  <div class="h-px bg-white/10"></div>
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/juvederm-fillers">Dermal Fillers</a>
                  <div class="h-px bg-white/10"></div>
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/prp-microneedling">PRP Therapy</a>
                  <div class="h-px bg-white/10"></div>
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/lip-filler">Lip Fillers</a>
                  <div class="h-px bg-white/10"></div>
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/botox-for-hyperhidrosis">Botox For Underarm Sweating</a>
                </div>
              </div>
            </details>

            <!-- Laser (móvil, single link) -->
            <a class="block px-4 py-3 rounded-xl border border-white/10 bg-white/5 hover:bg-white/5 focus:bg-white/10" href="/services/aerolase">Laser</a>

            <!-- Skin Goals (móvil) -->
            <details class="group rounded-xl border border-white/10 bg-white/5 open:bg-white/5 open:border-white/20 transition-colors">
              <summary class="list-none cursor-pointer flex items-center justify-between px-4 py-3">
                <span class="font-medium">Skin Goals</span>
                <svg class="w-5 h-5 transition-transform group-open:rotate-180" viewBox="0 0 20 20" fill="currentColor"><path d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z"/></svg>
              </summary>
              <div class="px-2 pb-2">
                <div class="mx-2 rounded-lg bg-white/5 ring-1 ring-white/10">
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/skinpen-microneedling">Skin Pen Microneedle</a>
                  <div class="h-px bg-white/10"></div>
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/smooth-threads">Smooth Threads</a>
                  <div class="h-px bg-white/10"></div>
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/sugaring">Sugaring</a>
                  <div class="h-px bg-white/10"></div>
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/signature-facials">Signature Facials</a>
                  <div class="h-px bg-white/10"></div>
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/facial-waxing">Facial Waxing</a>
                  <div class="h-px bg-white/10"></div>
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/acne-programs">Teen Acne Facial</a>
                </div>
              </div>
            </details>
<!-- Swedish Massage (móvil, single link) -->
            <a class="block px-4 py-3 rounded-xl border border-white/10 bg-white/5 hover:bg-white/5 focus:bg-white/10" href="/services/swedish_massage">Swedish Massage</a>
            <!-- Wellness (móvil) -->
            <details class="group rounded-xl border border-white/10 bg-white/5 open:bg-white/5 open:border-white/20 transition-colors">
              <summary class="list-none cursor-pointer flex items-center justify-between px-4 py-3">
                <span class="font-medium">Wellness</span>
                <svg class="w-5 h-5 transition-transform group-open:rotate-180" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z"/>
                </svg>
              </summary>
              <div class="px-2 pb-2">
                <div class="mx-2 rounded-lg bg-white/5 ring-1 ring-white/10">
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/vitamin-injections">Vitamin Injections</a>
                  <div class="h-px bg-white/10"></div>
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/iv-therapy">IV Therapy</a>
                  <div class="h-px bg-white/10"></div>
                  <!-- Added Teeth Whitening -->
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/teeth-whitening">Teeth Whitening</a>
                </div>
              </div>
            </details>

            <!-- Chemical Peel (móvil, nuevo nombre + submenu) -->
            <details class="group rounded-xl border border-white/10 bg-white/5 open:bg-white/5 open:border-white/20 transition-colors">
              <summary class="list-none cursor-pointer flex items-center justify-between px-4 py-3">
                <span class="font-medium">Chemical Peel</span>
                <svg class="w-5 h-5 transition-transform group-open:rotate-180" viewBox="0 0 20 20" fill="currentColor"><path d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z"/></svg>
              </summary>
              <div class="px-2 pb-2">
                <div class="mx-2 rounded-lg bg-white/5 ring-1 ring-white/10">
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/biorepeel">BioRePeel</a>
                  <div class="h-px bg-white/10"></div>
                  <a class="block px-4 py-3 hover:bg-white/10 focus:bg-white/10" href="/services/the-perfect-derma-peel">The Perfect Derma Peel</a>
                </div>
              </div>
            </details>

            <!-- Enlaces simples -->
            <a class="block px-4 py-3 rounded-xl border border-white/10 bg-white/5 hover:bg-white/5 focus:bg-white/10" href="/about-us">About Us</a>
            <a class="block px-4 py-3 rounded-xl border border-white/10 bg-white/5 hover:bg-white/5 focus:bg-white/10" href="/contact-us">Contact Us</a>
          </div>

          <!-- Separador degradado + logo -->
          <div class="mt-12 px-6">
            <div class="h-[2px] w-full bg-gradient-to-r from-transparent via-white to-transparent"></div>
            <a href="/" class="mt-6 w-full flex items-baseline justify-center gap-2 text-center" aria-label="Home">
              <span class="text-white/95 font-semibold tracking-[0.06em] text-[18px] leading-none">D-Essence</span>
              <span class="text-white/70 font-medium tracking-wide text-[14px] leading-none">Wellness</span>
            </a>
          </div>
        </nav>
      </div>
    </aside>

    <!-- ===== MAIN SLOT ===== -->
    <main><slot /></main>

    <!-- ===== FOOTER (sin CTA superior y sin línea encima) ===== -->
<footer class="mt-24 bg-black/50">
  <div class="container mx-auto px-4">
    <!-- Middle: brand + columns -->
    <section class="py-10">
      <div class="grid gap-10 md:grid-cols-4">
        <!-- Brand & socials -->
        <div>
          <!-- Logo (reemplazo del texto D-Essence Wellness) -->
          <a href="/" class="inline-block" aria-label="D-Essence Wellness">
            <img
              src="/LOGO_W.webp"
              alt="D-Essence Wellness"
              class="h-10 w-auto select-none pointer-events-none"
              width="180"
              height="40"
              loading="lazy"
              decoding="async"
            />
          </a>

          <p class="mt-3 text-sm text-neutral-400 max-w-xs">
            Evidence-based care to enhance your natural confidence.
          </p>

          <!-- Address (smart maps link) -->
          <div class="mt-4 text-sm text-neutral-300">
            <a
              id="map-link"
              class="hover:underline"
              href="https://www.google.com/maps/search/?api=1&query=871%20Blooming%20Grove%20Turnpike%20suite%20102%2C%20New%20Windsor%2C%20NY%2012553"
              target="_blank" rel="noopener"
            >
              871 Blooming Grove Turnpike suite 102, New Windsor, NY 12553
            </a>
          </div>

          <!-- Hours -->
          <div class="mt-4 text-sm text-neutral-300">
            <div class="font-medium text-white/90">Hours</div>
            <ul class="mt-2 space-y-1">
              <li>Monday: Closed</li>
              <li>Tuesday: 10 AM–7 PM</li>
              <li>Wednesday: Closed</li>
              <li>Thursday: 10 AM–7 PM</li>
              <li>Friday: 10 AM–6 PM</li>
              <li>Saturday: 10 AM–6 PM</li>
              <li>Sunday: Closed</li>
            </ul>
          </div>

          <!-- Socials -->
          <div class="mt-5 flex items-center gap-3">
            <!-- Instagram -->
            <a href="https://www.instagram.com/d_essencewellness/" aria-label="Instagram" target="_blank" rel="noopener"
               class="inline-flex h-9 w-9 items-center justify-center rounded-lg bg-white/5 border border-white/10 text-white/80 hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20 transition">
              <svg viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor" aria-hidden="true">
                <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5Zm0 2a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3H7Zm5 3a5 5 0 1 1 0 10 5 5 0 0 1 0-10Zm0 2.2a2.8 2.8 0 1 0 0 5.6 2.8 2.8 0 0 0 0-5.6ZM18 6.7a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/>
              </svg>
            </a>
            <!-- Facebook -->
            <a href="https://www.facebook.com/profile.php?id=100093851335127" aria-label="Facebook" target="_blank" rel="noopener"
               class="inline-flex h-9 w-9 items-center justify-center rounded-lg bg-white/5 border border-white/10 text-white/80 hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20 transition">
              <svg viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor" aria-hidden="true">
                <path d="M13.5 22v-8h2.6l.4-3h-3v-1.9c0-.9.3-1.5 1.6-1.5h1.5V4.1c-.8-.1-1.7-.1-2.5-.1-2.4 0-4 .9-4 3.7V11H7v3h2.1v8h4.4Z"/>
              </svg>
            </a>
          </div>
        </div>

        <!-- Company -->
        <div>
          <h5 class="text-white/90 font-medium">Company</h5>
          <ul class="mt-3 space-y-2 text-sm text-neutral-300">
            <li><a class="hover:underline" href="/about-us">About</a></li>
            <li><a class="hover:underline" href="/contact-us">Contact</a></li>
            <li><a class="hover:underline" href="https://pay.withcherry.com/dessencewellness?utm_source=practice&utm_medium=website&m=18897" target="_blank" rel="noopener">Cherry Payments</a></li>
            <li><a class="hover:underline" href="https://www.salonvision.com/dessencewellness/GiftCertificatePop.aspx" target="_blank" rel="noopener">Gift Certificates</a></li>
          </ul>
        </div>

        <!-- Services (Top 4 + all) -->
        <div>
          <h5 class="text-white/90 font-medium">Services</h5>
          <ul class="mt-3 space-y-2 text-sm text-neutral-300">
            <li><a class="hover:underline" href="/services/botox">Neurotoxins</a></li>
            <li><a class="hover:underline" href="/services/lip-filler">Lip Filler</a></li>
            <li><a class="hover:underline" href="/services/skinpen-microneedling">SkinPen Microneedling</a></li>
            <li><a class="hover:underline" href="/services/aerolase">Aerolase</a></li>
          </ul>
        </div>

        <!-- Resources / Policies -->
        <div>
          <h5 class="text-white/90 font-medium">Resources</h5>
          <ul class="mt-3 space-y-2 text-sm text-neutral-300">
            <li><a class="hover:underline" href="/terms-and-conditions">Terms &amp; Conditions</a></li>
            <li><a class="hover:underline" href="/privacy-policy">Privacy Policy</a></li>
            <li><a class="hover:underline" href="/hipaa">HIPAA</a></li>
            <li><a class="hover:underline" href="/booking-policy">Booking Policy</a></li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Bottom line (se mantiene) -->
    <div class="border-t border-white/10 py-6">
      <div class="text-center text-xs text-neutral-500">
        © 2025 D-Essence Wellness. All rights reserved.
      </div>
    </div>
  </div>
</footer>

    <!-- ===== TEXT US (INLINE, SIN REACT) ===== -->
    <div id="textus-root" class="fixed bottom-4 right-4 z-[60]">
      <!-- Teaser (aparece 1 vez cada 7 días por ~8s) -->
      <div id="textus-teaser" class="hidden absolute bottom-16 right-0 max-w-[90vw] sm:max-w-[460px] translate-y-1">
        <div class="relative rounded-2xl bg-neutral-950 text-white px-3 py-3 text-sm shadow-xl ring-1 ring-white/10">
          <div class="flex items-start gap-2">
            <img
              src="/Cover.webp"
              alt=""
              class="h-7 w-7 rounded-full object-cover ring-1 ring-white/10"
              loading="lazy" decoding="async" width="28" height="28"
            />
            <p class="leading-snug">
              Hi there, have a question? <span class="font-medium">Text us here.</span>
            </p>
          </div>
          <div class="absolute -bottom-1 right-6 h-3 w-3 rotate-45 bg-neutral-950 ring-1 ring-white/10" aria-hidden></div>
          <button id="textus-teaser-close"
            aria-label="Dismiss"
            class="absolute right-1.5 top-1.5 rounded-full p-1 text-white/50 hover:text-white focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20">
            <svg class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6.225 4.811l12.964 12.964-1.414 1.414L4.811 6.225l1.414-1.414z" />
              <path d="M19.189 6.225L6.225 19.189l-1.414-1.414L17.775 4.811l1.414 1.414z" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Botón flotante (abrir) -->
      <button id="textus-open"
        aria-haspopup="dialog" aria-expanded="false" aria-controls="textus-panel"
        class="group flex items-center gap-2 rounded-full bg-black px-5 py-3 text-white shadow-lg shadow-black/30 ring-1 ring-white/10 transition hover:bg-black/90 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20">
        <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M2 5a3 3 0 013-3h14a3 3 0 013 3v10a3 3 0 01-3 3H8.414l-3.707 3.707A1 1 0 013 21v-3.586A3 3 0 012 14V5z" />
        </svg>
        <span class="font-medium">Text us</span>
      </button>

      <!-- Panel -->
      <div id="textus-panel" role="dialog" aria-modal="true" aria-label="Send us a message"
        class="hidden fixed bottom-20 right-4 w-[340px] max-w-[90vw] overflow-hidden rounded-2xl border border-white/10 bg-neutral-950 text-white shadow-2xl backdrop-blur supports-[backdrop-filter]:bg-neutral-950/95">
        <div class="flex items-center gap-2 px-4 py-3 border-b border-white/10">
          <svg class="h-5 w-5 text-white/90" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M2 5a3 3 0 013-3h14a3 3 0 013 3v10a3 3 0 01-3 3H8.414l-3.707 3.707A1 1 0 013 21v-3.586A3 3 0 012 14V5z" />
          </svg>
          <p class="text-sm font-semibold">Send us a message</p>
          <button id="textus-close"
            aria-label="Close"
            class="ml-auto inline-flex h-8 w-8 items-center justify-center rounded-lg text-white/70 hover:text-white hover:bg-white/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/20">
            <svg class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor"><path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          </button>
        </div>

        <div class="p-4">
          <p class="mb-3 rounded-2xl bg-white/5 ring-1 ring-white/10 px-3 py-2 text-sm text-white/90">
            Enter your info and we’ll email our team. We reply quickly during business hours.
          </p>

          <form id="textus-form" class="rounded-2xl" novalidate>
            <!-- FormSubmit hidden settings -->
            <input type="hidden" name="_subject" value="New website text lead — D-Essence Wellness" />
            <input type="hidden" name="_template" value="table" />
            <input type="hidden" name="_captcha" value="false" />
            <input type="text" name="_honey" class="hidden" tabindex="-1" autocomplete="off" />
            <input type="hidden" name="Page URL" value="" id="textus-pageurl" />
            <input type="hidden" name="_replyto" value="" id="textus-replyto" />

            <label class="block">
              <span class="block text-xs font-medium text-white/80">Name<span class="text-red-500">*</span></span>
              <input name="Name" required autocomplete="name" class="mt-1 block w-full border-0 border-b border-white/20 bg-transparent px-0 py-2 text-sm text-white placeholder:text-neutral-400 outline-none focus:border-white/40" />
            </label>

            <label class="block mt-3">
              <span class="block text-xs font-medium text-white/80">Email<span class="text-red-500">*</span></span>
              <input id="textus-email" name="Email" type="email" required autocomplete="email" class="mt-1 block w-full border-0 border-b border-white/20 bg-transparent px-0 py-2 text-sm text-white placeholder:text-neutral-400 outline-none focus:border-white/40" />
            </label>

            <label class="block mt-3">
              <span class="block text-xs font-medium text-white/80">Mobile Phone<span class="text-red-500">*</span></span>
              <input id="textus-phone" name="Phone" type="tel" inputmode="tel" required class="mt-1 block w-full border-0 border-b border-white/20 bg-transparent px-0 py-2 text-sm text-white placeholder:text-neutral-400 outline-none focus:border-white/40" autocomplete="tel" />
            </label>

            <label class="block mt-3">
              <span class="block text-xs font-medium text-white/80">Message<span class="text-red-500">*</span></span>
              <textarea id="textus-message" name="Message" rows="3" required class="mt-1 block w-full resize-y border-0 border-b border-white/20 bg-transparent px-0 py-2 text-sm text-white placeholder:text-neutral-400 outline-none focus:border-white/40"></textarea>
            </label>

            <p class="mt-3 text-[11px] leading-snug text-neutral-400">
              By submitting, you authorize D-Essence Wellness to contact you. Message/data rates may apply.
              Consent isn’t a condition of purchase. <a class="underline" href="/terms-and-conditions">See terms</a>.
            </p>

            <div class="mt-4">
              <button id="textus-submit" type="submit"
                class="inline-flex items-center justify-center rounded-lg bg-black px-4 py-2 text-sm font-semibold text-white transition hover:bg-black/90 disabled:opacity-60">
                Send
              </button>
            </div>

            <p id="textus-ok"  class="hidden mt-3 text-xs text-emerald-400"></p>
            <p id="textus-err" class="hidden mt-3 text-xs text-red-400"></p>
          </form>
        </div>
      </div>

      <!-- Botón cerrar flotante (cuando panel abierto) -->
      <button id="textus-fab-close" aria-label="Close"
        class="hidden fixed bottom-4 right-4 grid h-12 w-12 place-items-center rounded-full bg-white/10 text-white shadow-xl ring-1 ring-white/10 transition hover:bg-white/15 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/30">
        <svg class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M6.225 4.811l12.964 12.964-1.414 1.414L4.811 6.225l1.414-1.414z" />
          <path d="M19.189 6.225L6.225 19.189l-1.414-1.414L17.775 4.811l1.414 1.414z" />
        </svg>
      </button>
    </div>

    <!-- ===== SCRIPTS ===== -->
    <script is:inline>
      // ---------- Desktop submenu A11y + Hover Intent ----------
      (function () {
        var triggers = document.querySelectorAll('[data-menu-trigger]');
        var openKeyPanel = null;
        var OPEN_DELAY = 120;
        var CLOSE_DELAY = 200;

        function panelFor(btn) { var id = btn.getAttribute('data-menu-trigger'); return document.querySelector('[data-menu-panel="' + id + '"]'); }
        function setExpanded(btn, expanded) { btn.setAttribute('aria-expanded', String(expanded)); }
        function forceOpen(panel, btn) {
          panel.classList.remove('opacity-0','translate-y-1','pointer-events-none');
          panel.classList.add('opacity-100','translate-y-0','pointer-events-auto');
          if (btn) setExpanded(btn, true);
        }
        function forceClose(panel, btn) {
          panel.classList.add('opacity-0','translate-y-1','pointer-events-none');
          panel.classList.remove('opacity-100','translate-y-0','pointer-events-auto');
          if (btn) setExpanded(btn, false);
        }
        function ensureTimers(el) { if (!el._intentTimers) el._intentTimers = { openTimer: null, closeTimer: null }; return el._intentTimers; }

        triggers.forEach(function (btn) {
          var panel = panelFor(btn); if (!panel) return;
          var timers = ensureTimers(panel);
          var root = btn.closest('li') || btn.parentElement;

          function openWithIntent() {
            triggers.forEach(function (b) { if (b !== btn) { var p = panelFor(b); p && forceClose(p, b); }});
            forceOpen(panel, btn);
          }
          function queueOpen() { clearTimeout(timers.closeTimer); clearTimeout(timers.openTimer); timers.openTimer = setTimeout(openWithIntent, OPEN_DELAY); }
          function queueClose() {
            clearTimeout(timers.openTimer); clearTimeout(timers.closeTimer);
            timers.closeTimer = setTimeout(function () {
              var stillHover = btn.matches(':hover') || panel.matches(':hover') || (root && root.matches(':hover'));
              if (!stillHover) forceClose(panel, btn);
            }, CLOSE_DELAY);
          }

          btn.addEventListener('mouseenter', queueOpen);
          btn.addEventListener('mouseleave', queueClose);
          panel.addEventListener('mouseenter', function () { clearTimeout(timers.closeTimer); });
          panel.addEventListener('mouseleave', queueClose);

          btn.addEventListener('keydown', function (e) {
            var key = e.key;
            if (key === 'Enter' || key === ' ') {
              e.preventDefault();
              var expanded = btn.getAttribute('aria-expanded') === 'true';
              if (expanded) { forceClose(panel, btn); }
              else {
                triggers.forEach(function (b) { if (b !== btn) { var p = panelFor(b); p && forceClose(p, b); }});
                forceOpen(panel, btn);
                var firstItem = panel.querySelector('a, button, [tabindex]:not([tabindex="-1"])');
                if (firstItem) firstItem.focus();
                openKeyPanel = panel;
              }
            } else if (key === 'Escape') {
              forceClose(panel, btn);
            } else if (key === 'ArrowDown') {
              e.preventDefault();
              forceOpen(panel, btn);
              var first = panel.querySelector('a, button, [tabindex]:not([tabindex="-1"])');
              if (first) first.focus();
              openKeyPanel = panel;
            }
          });

          panel.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') { forceClose(panel, btn); btn.focus(); }
          });

          panel.addEventListener('focusout', function () {
            setTimeout(function () {
              var active = document.activeElement;
              if (!panel.contains(active) && active !== btn) forceClose(panel, btn);
            }, 0);
          });
        });

        document.addEventListener('keydown', function (e) {
          if (e.key === 'Escape') {
            var openPanels = document.querySelectorAll('[data-menu-panel]');
            openPanels.forEach(function (p) {
              var id = p.getAttribute('data-menu-panel');
              var b = document.querySelector('[data-menu-trigger="' + id + '"]');
              if (b) {
                p.classList.add('opacity-0','translate-y-1','pointer-events-none');
                b.setAttribute('aria-expanded','false');
              }
            });
          }
        });
      })();

      // ---------- Mobile drawer (scroll lock real + focus trap + overlays) ----------
      (function () {
        var checkbox = document.getElementById('nav-toggle');
        var drawer = document.getElementById('mobile-drawer');
        var overlays = Array.prototype.slice.call(document.querySelectorAll('.peer ~ div'));
        var closeBtn = drawer && drawer.querySelector('[data-close-drawer]');
        if (!checkbox || !drawer) return;

        var scrollY = 0;

        function getFocusable(container) {
          var selectors = [
            'a[href]', 'button:not([disabled])', 'summary', 'input:not([disabled])',
            'select:not([disabled])', 'textarea:not([disabled])',
            '[tabindex]:not([tabindex="-1"])'
          ].join(',');
          return Array.prototype.slice.call(container.querySelectorAll(selectors))
            .filter(function (el) { return !el.hasAttribute('inert') && !el.closest('[hidden]'); });
        }

        function lockScroll() {
          scrollY = window.scrollY || document.documentElement.scrollTop;
          document.body.style.position = 'fixed';
          document.body.style.top = (-scrollY) + 'px';
          document.body.style.left = '0';
          document.body.style.right = '0';
          document.body.style.width = '100%';
          document.documentElement.classList.add('overscroll-none');
          document.body.classList.add('overscroll-none');
        }

        function unlockScroll() {
          document.body.style.position = '';
          document.body.style.top = '';
          document.body.style.left = '';
          document.body.style.right = '';
          document.body.style.width = '';
          document.documentElement.classList.remove('overscroll-none');
          document.body.classList.remove('overscroll-none');
          window.scrollTo(0, scrollY);
        }

        function openDrawer() {
          lockScroll();
          var focusables = getFocusable(drawer);
          var first = focusables[0];
          var last  = focusables[focusables.length - 1];

          function trap(e) {
            if (e.key !== 'Tab') return;
            if (!first || !last) return;
            if (e.shiftKey && document.activeElement === first) { e.preventDefault(); last.focus(); }
            else if (!e.shiftKey && document.activeElement === last) { e.preventDefault(); first.focus(); }
          }

          function onKeydown(e) {
            if (e.key === 'Escape') { checkbox.checked = false; closeDrawer(); }
            else { trap(e); }
          }

          drawer._onKeydown = onKeydown;
          document.addEventListener('keydown', onKeydown);
          setTimeout(function () { (first || closeBtn)?.focus(); }, 0);
        }

        function closeDrawer() {
          unlockScroll();
          var onKeydown = drawer._onKeydown;
          if (onKeydown) {
            document.removeEventListener('keydown', onKeydown);
            drawer._onKeydown = null;
          }
        }

        checkbox.addEventListener('change', function () {
          if (checkbox.checked) openDrawer(); else closeDrawer();
        });

        // Close controls
        if (closeBtn) closeBtn.addEventListener('click', function () {
          checkbox.checked = false; closeDrawer();
        });
        overlays.forEach(function (ov) {
          ov.addEventListener('click', function () {
            checkbox.checked = false; closeDrawer();
          });
        });
      })();
    </script>

    <!-- Text Us logic -->
    <script is:inline>
      (function () {
        var root   = document.getElementById('textus-root');
        if (!root) return;

        var teaser = document.getElementById('textus-teaser');
        var teaserClose = document.getElementById('textus-teaser-close');
        var openBtn = document.getElementById('textus-open');
        var panel   = document.getElementById('textus-panel');
        var closeBtn = document.getElementById('textus-close');
        var fabClose = document.getElementById('textus-fab-close');

        var form   = document.getElementById('textus-form');
        var submit = document.getElementById('textus-submit');
        var okMsg  = document.getElementById('textus-ok');
        var errMsg = document.getElementById('textus-err');

        var email  = document.getElementById('textus-email');
        var replyto= document.getElementById('textus-replyto');
        var pageurl= document.getElementById('textus-pageurl');

        var ENDPOINT = 'https://formsubmit.co/ajax/dessenceaesthetics@gmail.com';

        // Page URL
        if (pageurl) pageurl.value = window.location.href;

        // Teaser show (cada 7 días)
        try {
          var ts = localStorage.getItem('textus_teaser_dismissed_at');
          var week = 7 * 24 * 60 * 60 * 1000;
          var shouldShow = !ts || (Date.now() - Number(ts) > week);
          if (shouldShow && teaser) {
            teaser.classList.remove('hidden');
            setTimeout(function(){ teaser.classList.add('hidden'); }, 8000);
          }
        } catch (_) {}

        function dismissTeaser() {
          try { localStorage.setItem('textus_teaser_dismissed_at', String(Date.now())); } catch (_){}
          if (teaser) teaser.classList.add('hidden');
        }
        if (teaserClose) teaserClose.addEventListener('click', dismissTeaser);

        function openPanel() {
          if (panel) panel.classList.remove('hidden');
          if (openBtn) openBtn.classList.add('hidden');
          if (fabClose) fabClose.classList.remove('hidden');
          dismissTeaser();
          if (openBtn) openBtn.setAttribute('aria-expanded', 'true');
        }

        function closePanel() {
          if (panel) panel.classList.add('hidden');
          if (openBtn) openBtn.classList.remove('hidden');
          if (fabClose) fabClose.classList.add('hidden');
          if (openBtn) openBtn.setAttribute('aria-expanded', 'false');
        }

        if (openBtn)  openBtn.addEventListener('click', openPanel);
        if (closeBtn) closeBtn.addEventListener('click', closePanel);
        if (fabClose) fabClose.addEventListener('click', closePanel);

        // Cerrar por click fuera
        document.addEventListener('mousedown', function (e) {
          if (!panel || panel.classList.contains('hidden')) return;
          if (!panel.contains(e.target) && !openBtn.contains(e.target)) closePanel();
        });

        // Cerrar por ESC
        document.addEventListener('keydown', function (e) {
          if (e.key === 'Escape') closePanel();
        });

        // _replyto sync con Email
        if (email && replyto) {
          email.addEventListener('input', function(){ replyto.value = email.value; });
        }

        // Envío AJAX
        if (form && submit) {
          form.addEventListener('submit', function (e) {
            e.preventDefault();
            if (okMsg) okMsg.classList.add('hidden');
            if (errMsg) errMsg.classList.add('hidden');
            submit.disabled = true;
            submit.textContent = 'Sending…';

            // Validaciones mínimas
            var phoneEl = document.getElementById('textus-phone');
            var msgEl   = document.getElementById('textus-message');

            var phone = phoneEl ? String(phoneEl.value || '') : '';
            var digits = phone.replace(/[^0-9]/g, '');
            if (!digits || digits.length < 10) {
              if (errMsg) { errMsg.textContent = 'Please provide a valid mobile phone.'; errMsg.classList.remove('hidden'); }
              submit.disabled = false; submit.textContent = 'Send';
              return;
            }
            var msg = msgEl ? String(msgEl.value || '').trim() : '';
            if (msg.length < 10) {
              if (errMsg) { errMsg.textContent = 'Message must be at least 10 characters.'; errMsg.classList.remove('hidden'); }
              submit.disabled = false; submit.textContent = 'Send';
              return;
            }

            var fd = new FormData(form);
            fetch(ENDPOINT, { method: 'POST', headers: { 'Accept': 'application/json' }, body: fd })
              .then(function (res) {
                return res.json().catch(function(){ return {}; }).then(function(data){ return { ok: res.ok, data: data }; });
              })
              .then(function (resp) {
                if (!resp.ok) throw new Error(resp.data?.message || 'Request failed');
                form.reset();
                if (okMsg) { okMsg.textContent = 'Thanks! We received your message.'; okMsg.classList.remove('hidden'); }
                setTimeout(closePanel, 1100);
              })
              .catch(function (err) {
                if (errMsg) { errMsg.textContent = (err && err.message) ? err.message : 'Something went wrong.'; errMsg.classList.remove('hidden'); }
              })
              .finally(function () {
                submit.disabled = false;
                submit.textContent = 'Send';
              });
          }, { passive: false });
        }
      })();
    </script>

    <!-- Smart Maps link (Apple Maps en iOS, Google Maps en otros) -->
    <script is:inline>
      (function () {
        var el = document.getElementById('map-link');
        if (!el) return;
        var address = '871 Blooming Grove Turnpike suite 102, New Windsor, NY 12553';
        var encoded = encodeURIComponent(address);
        var ua = navigator.userAgent || navigator.vendor || window.opera;
        var isIOS = /iPad|iPhone|iPod/.test(ua);
        var appleHref = 'https://maps.apple.com/?q=' + encoded;
        var googleHref = 'https://www.google.com/maps/search/?api=1&query=' + encoded;
        el.setAttribute('href', isIOS ? appleHref : googleHref);
      })();
    </script>
  </body>
</html>
