---
---
<header class="fixed top-4 left-1/2 -translate-x-1/2 z-50 w-full max-w-screen-xl pointer-events-none">
  <!-- Desktop -->
  <div class="hidden md:flex items-center justify-center">
    <nav id="main-nav" class="relative flex items-center gap-1 rounded-full border border-white/10 bg-black/80 shadow-lg px-3 py-2 pointer-events-auto leading-none" aria-label="Primary">
      <!-- Wordmark -->
      <a href="/" class="flex items-center px-3 h-10 rounded-full hover:bg-white/5 transition" aria-label="Home">
        <span class="inline-flex items-center h-full">
          <span class="text-white/95 font-semibold tracking-[0.06em] text-[14px] leading-none">D-Essence</span>
          <span class="ml-1.5 text-white/70 font-medium tracking-wide text-[12.5px] leading-none">Wellness</span>
        </span>
      </a>

      <!-- Categorías -->
      <ul class="flex items-center gap-1 h-10">
        <!-- Injectables -->
        <li class="relative" data-nav-item>
          <button class="relative px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white"
                  data-nav-trigger aria-haspopup="true" aria-expanded="false" aria-controls="panel-injectables">
            Injectables
            <svg class="ml-1 w-4 h-4 opacity-70" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z" clip-rule="evenodd"/></svg>
          </button>
          <div id="panel-injectables" data-nav-panel class="absolute left-1/2 -translate-x-1/2 mt-2 w-[90vw] sm:w-[520px] rounded-2xl border border-white/10 bg-neutral-950 shadow-2xl shadow-black/40 p-1 max-h-[70vh] overflow-auto hidden">
            <ul class="divide-y divide-white/10">
              <li><a href="/services/botox" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90">Botox<span class="opacity-60">→</span></a></li>
              <li><a href="/services/xeomin" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90">Xeomin<span class="opacity-60">→</span></a></li>
              <li><a href="/services/daxxify" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90">Daxxify<span class="opacity-60">→</span></a></li>
              <li><a href="/services/botox-for-hyperhidrosis" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90">Botox for Hyperhidrosis<span class="opacity-60">→</span></a></li>
              <li><a href="/services/prp-microneedling" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90">PRP Microneedling<span class="opacity-60">→</span></a></li>
              <li><a href="/services/prf-microneedling" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90">PRF Microneedling<span class="opacity-60">→</span></a></li>
              <li><a href="/services/juvederm-fillers" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90">Dermal Fillers — Juvederm Collection<span class="opacity-60">→</span></a></li>
              <li><a href="/services/smooth-threads" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90">Threads — Smooth Threads<span class="opacity-60">→</span></a></li>
            </ul>
          </div>
        </li>

        <!-- Laser Treatments -->
        <li class="relative" data-nav-item>
          <button class="relative px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white"
                  data-nav-trigger aria-haspopup="true" aria-expanded="false" aria-controls="panel-laser">
            Laser Treatments
            <svg class="ml-1 w-4 h-4 opacity-70" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z" clip-rule="evenodd"/></svg>
          </button>
          <div id="panel-laser" data-nav-panel class="absolute left-1/2 -translate-x-1/2 mt-2 w-[90vw] sm:w-[360px] rounded-2xl border border-white/10 bg-neutral-950 shadow-2xl shadow-black/40 p-1 max-h-[70vh] overflow-auto hidden">
            <ul class="divide-y divide-white/10">
              <li><a href="/services/aerolase" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90">Aerolase<span class="opacity-60">→</span></a></li>
              <li><a href="/services/laser-hair-removal" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90">Laser Hair Removal<span class="opacity-60">→</span></a></li>
            </ul>
          </div>
        </li>

        <!-- Aesthetic Services -->
        <li class="relative" data-nav-item>
          <button class="relative px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white"
                  data-nav-trigger aria-haspopup="true" aria-expanded="false" aria-controls="panel-aesthetic">
            Aesthetic Services
            <svg class="ml-1 w-4 h-4 opacity-70" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z" clip-rule="evenodd"/></svg>
          </button>
          <div id="panel-aesthetic" data-nav-panel class="absolute left-1/2 -translate-x-1/2 mt-2 w-[90vw] sm:w-[420px] rounded-2xl border border-white/10 bg-neutral-950 shadow-2xl shadow-black/40 p-1 max-h-[70vh] overflow-auto hidden">
            <ul class="divide-y divide-white/10">
              <li><a href="/services/waxing-sugaring" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90">Waxing &amp; Sugaring<span class="opacity-60">→</span></a></li>
              <li><a href="/services/teeth-whitening" class="flex items-center justify-between px-4 py-2.5 hover:bg-white/5 text-white/90">Teeth Whitening<span class="opacity-60">→</span></a></li>
            </ul>
          </div>
        </li>

        <!-- Enlaces simples -->
        <li class="relative"><a href="/about-us" class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white">About Us</a></li>
        <li class="relative"><a href="/contact-us" class="px-3 h-10 inline-flex items-center rounded-full hover:bg-white/5 transition text-white/90 hover:text-white">Contact Us</a></li>
      </ul>
    </nav>
  </div>

  <!-- Mobile -->
  <div class="md:hidden pointer-events-auto px-4">
    <div class="flex items-center justify-between rounded-2xl border border-white/10 bg-neutral-900/80 text-white backdrop-blur-sm shadow-lg px-3 py-2">
      <a href="/" class="py-2" aria-label="Home">
        <span class="inline-flex items-baseline gap-1.5">
          <span class="text-white/95 font-semibold tracking-[0.06em] text-[14px]">D-Essence</span>
          <span class="text-white/70 font-medium tracking-wide text-[12.5px]">Wellness</span>
        </span>
      </a>

      <button id="mobile-toggle" class="p-2 rounded-lg hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/20" aria-expanded="false" aria-controls="mobile-menu" aria-label="Open menu">
        <svg id="icon-open" class="w-6 h-6" viewBox="0 0 24 24" fill="none"><path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        <svg id="icon-close" class="w-6 h-6 hidden" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      </button>
    </div>
  </div>
</header>

<!-- Mobile FULLSCREEN MENU (independiente del header) -->
<div id="mobile-menu" class="fixed inset-0 hidden" aria-hidden="true" style="z-index:2147483647;">
  <div class="absolute inset-0 bg-neutral-950"></div>
  <nav class="absolute inset-y-0 right-0 w-full max-w-sm bg-neutral-900 text-white border-l border-white/10 shadow-2xl">
    <div class="p-4">
      <div class="flex items-center justify-between">
        <span class="text-sm uppercase tracking-wide text-white/60">Navigation</span>
        <button id="mobile-close" class="p-2 rounded-lg hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/20" aria-label="Close menu">
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </button>
      </div>

      <!-- Grupos -->
      <div class="mt-3 border border-white/10 rounded-xl overflow-hidden">
        <button class="w-full flex items-center justify-between px-4 py-3 text-left hover:bg-white/5" data-acc-btn aria-expanded="false" aria-controls="m-injectables">
          <span class="font-medium">Injectables</span>
          <svg class="w-5 h-5 rotate-0 transition-transform" viewBox="0 0 20 20" fill="currentColor"><path d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z"/></svg>
        </button>
        <div id="m-injectables" class="hidden border-t border-white/10">
          <a class="block px-4 py-2.5 hover:bg-white/5" href="/services/botox">Botox</a>
          <a class="block px-4 py-2.5 hover:bg-white/5" href="/services/xeomin">Xeomin</a>
          <a class="block px-4 py-2.5 hover:bg-white/5" href="/services/daxxify">Daxxify</a>
          <a class="block px-4 py-2.5 hover:bg-white/5" href="/services/botox-for-hyperhidrosis">Botox for Hyperhidrosis</a>
          <a class="block px-4 py-2.5 hover:bg-white/5" href="/services/prp-microneedling">PRP Microneedling</a>
          <a class="block px-4 py-2.5 hover:bg-white/5" href="/services/prf-microneedling">PRF Microneedling</a>
          <a class="block px-4 py-2.5 hover:bg-white/5" href="/services/juvederm-fillers">Dermal Fillers — Juvederm Collection</a>
          <a class="block px-4 py-2.5 hover:bg-white/5" href="/services/smooth-threads">Threads — Smooth Threads</a>
        </div>
      </div>

      <div class="mt-3 border border-white/10 rounded-xl overflow-hidden">
        <button class="w-full flex items-center justify-between px-4 py-3 text-left hover:bg-white/5" data-acc-btn aria-expanded="false" aria-controls="m-laser">
          <span class="font-medium">Laser Treatments</span>
          <svg class="w-5 h-5 rotate-0 transition-transform" viewBox="0 0 20 20" fill="currentColor"><path d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z"/></svg>
        </button>
        <div id="m-laser" class="hidden border-t border-white/10">
          <a class="block px-4 py-2.5 hover:bg-white/5" href="/services/aerolase">Aerolase</a>
          <a class="block px-4 py-2.5 hover:bg-white/5" href="/services/laser-hair-removal">Laser Hair Removal</a>
        </div>
      </div>

      <div class="mt-3 border border-white/10 rounded-xl overflow-hidden">
        <button class="w-full flex items-center justify-between px-4 py-3 text-left hover:bg-white/5" data-acc-btn aria-expanded="false" aria-controls="m-aesthetic">
          <span class="font-medium">Aesthetic Services</span>
          <svg class="w-5 h-5 rotate-0 transition-transform" viewBox="0 0 20 20" fill="currentColor"><path d="M5.8 7.3a1 1 0 011.4 0L10 10.1l2.8-2.8a1 1 0 111.4 1.4l-3.5 3.5a1 1 0 01-1.4 0L5.8 8.7a1 1 0 010-1.4z"/></svg>
        </button>
        <div id="m-aesthetic" class="hidden border-t border-white/10">
          <a class="block px-4 py-2.5 hover:bg-white/5" href="/services/waxing-sugaring">Waxing &amp; Sugaring</a>
          <a class="block px-4 py-2.5 hover:bg-white/5" href="/services/teeth-whitening">Teeth Whitening</a>
        </div>
      </div>

      <!-- Links simples -->
      <div class="mt-6 space-y-2">
        <a class="block px-4 py-3 rounded-xl border border-white/10 hover:bg-white/5" href="/about-us">About Us</a>
        <a class="block px-4 py-3 rounded-xl border border-white/10 hover:bg-white/5" href="/contact-us">Contact Us</a>
      </div>
    </div>
  </nav>
</div>

<!-- JS: Desktop hovers + Mobile menu -->
<script is:inline>
(function(){
  /* ========== DESKTOP MENUS ========== */
  const nav = document.getElementById('main-nav'); if (nav){
    const items = [...nav.querySelectorAll('[data-nav-item]')];
    const panels = () => [...nav.querySelectorAll('[data-nav-panel]')];
    let t=null, DELAY=180;

    function openOnly(item){
      panels().forEach(p=>p.classList.add('hidden'));
      items.forEach(i=>i.querySelector('[data-nav-trigger]')?.setAttribute('aria-expanded','false'));
      const p=item.querySelector('[data-nav-panel]'); const b=item.querySelector('[data-nav-trigger]');
      if(p&&b){ p.classList.remove('hidden'); b.setAttribute('aria-expanded','true'); constrain(p); }
    }
    function closeAll(){
      panels().forEach(p=>p.classList.add('hidden'));
      items.forEach(i=>i.querySelector('[data-nav-trigger]')?.setAttribute('aria-expanded','false'));
    }
    function constrain(panel){
      panel.style.transform='translateX(-50%)';
      const r=panel.getBoundingClientRect(), vw=innerWidth, pad=8;
      let dx=0; if(r.left<pad) dx=pad-r.left; else if(r.right>vw-pad) dx=(vw-pad)-r.right;
      if(dx) panel.style.transform=`translateX(calc(-50% + ${dx}px))`;
    }

    items.forEach(item=>{
      const btn=item.querySelector('[data-nav-trigger]'); const p=item.querySelector('[data-nav-panel]');
      if(!btn||!p) return;
      item.addEventListener('mouseenter',()=>{ if(t)clearTimeout(t); openOnly(item); });
      item.addEventListener('mouseleave',()=>{ t=setTimeout(closeAll,DELAY); });
      btn.addEventListener('focus',()=>openOnly(item));
      btn.addEventListener('blur', ()=>{ t=setTimeout(closeAll,DELAY); });
      p.addEventListener('mouseenter',()=>{ if(t)clearTimeout(t); });
      p.addEventListener('mouseleave',()=>{ t=setTimeout(closeAll,DELAY); });
      addEventListener('resize',()=>{ if(!p.classList.contains('hidden')) constrain(p); });
    });

    addEventListener('click',e=>{ if(!nav.contains(e.target)) closeAll(); });
    addEventListener('keydown',e=>{ if(e.key==='Escape') closeAll(); });
  }

  /* ========== MOBILE MENU (desde cero) ========== */
  const toggle = document.getElementById('mobile-toggle');
  const closeBtn= document.getElementById('mobile-close');
  const menu   = document.getElementById('mobile-menu');
  const iconOpen = document.getElementById('icon-open');
  const iconClose= document.getElementById('icon-close');

  let locked=false, scrollY=0;

  function lockScroll(){
    if(locked) return;
    scrollY = window.scrollY || window.pageYOffset;
    document.documentElement.classList.add('overflow-hidden');
    document.body.style.position='fixed';
    document.body.style.top = `-${scrollY}px`;
    document.body.style.left='0'; document.body.style.right='0'; document.body.style.width='100%';
    locked=true;
  }
  function unlockScroll(){
    if(!locked) return;
    const y=-parseInt(document.body.style.top||'0',10);
    document.documentElement.classList.remove('overflow-hidden');
    document.body.style.position=''; document.body.style.top=''; document.body.style.left=''; document.body.style.right=''; document.body.style.width='';
    window.scrollTo(0,y);
    locked=false;
  }

  function openMenu(){
    if(!menu) return;
    menu.classList.remove('hidden');
    toggle?.setAttribute('aria-expanded','true');
    iconOpen?.classList.add('hidden'); iconClose?.classList.remove('hidden');
    lockScroll();
    // focus inicial
    const first = menu.querySelector('[data-acc-btn]') || menu.querySelector('a,button');
    first && first.focus();
  }
  function closeMenu(){
    if(!menu) return;
    menu.classList.add('hidden');
    toggle?.setAttribute('aria-expanded','false');
    iconClose?.classList.add('hidden'); iconOpen?.classList.remove('hidden');
    unlockScroll();
    toggle?.focus();
  }

  toggle?.addEventListener('click', ()=> menu.classList.contains('hidden') ? openMenu() : closeMenu());
  closeBtn?.addEventListener('click', closeMenu);
  // click fuera del panel (área oscura)
  menu?.addEventListener('click', (e)=>{
    const panel = menu.querySelector('nav');
    if(panel && !panel.contains(e.target)) closeMenu();
  });
  addEventListener('keydown', (e)=>{ if(e.key==='Escape' && menu && !menu.classList.contains('hidden')) closeMenu(); });

  // Acordeones mobile (uno a la vez)
  const accBtns = [...document.querySelectorAll('#mobile-menu [data-acc-btn]')];
  accBtns.forEach(btn=>{
    const id=btn.getAttribute('aria-controls'); const p=document.getElementById(id); const chev=btn.querySelector('svg');
    if(!p) return;
    btn.addEventListener('click', ()=>{
      const expanded = btn.getAttribute('aria-expanded')==='true';
      accBtns.forEach(b=>{
        const _id=b.getAttribute('aria-controls'); const _p=document.getElementById(_id); const _c=b.querySelector('svg');
        if(_p && b!==btn){ b.setAttribute('aria-expanded','false'); _p.classList.add('hidden'); _c?.classList.remove('rotate-180'); }
      });
      btn.setAttribute('aria-expanded', (!expanded).toString());
      p.classList.toggle('hidden', expanded);
      chev?.classList.toggle('rotate-180', !expanded);
    });
  });

  // Focus trap dentro del menú móvil
  menu?.addEventListener('keydown', (e)=>{
    if(e.key!=='Tab') return;
    const F = [...menu.querySelectorAll('a,button,[tabindex]:not([tabindex="-1"])')].filter(el=>!el.hasAttribute('disabled'));
    if(F.length===0) return;
    const first=F[0], last=F[F.length-1];
    if(e.shiftKey && document.activeElement===first){ e.preventDefault(); last.focus(); }
    else if(!e.shiftKey && document.activeElement===last){ e.preventDefault(); first.focus(); }
  });
})();
</script>
